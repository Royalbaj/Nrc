<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charging Stations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        h2, h3 {
            color: #8cbbed;
        }
        button {
            background-color: #8cbbed;
            color: #121212;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #ffb300;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #222;
        }
        tr:hover {
            background-color: #333;
        }
        a {
            color: #8cbbed;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #nearest-stations {
            margin-top: 20px;
            display: none;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
            background-color: #222;
            padding: 10px;
            border-radius: 5px;
        }
        @media (max-width: 600px) {
            th, td {
                font-size: 14px;
            }
            button {
                width: 100%;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

<h2>Charging Stations</h2>
<button id="get-location">Find Nearest Charging Stations</button>
<div id="nearest-stations">
    <h3>Nearest Charging Stations:</h3>
    <ul id="station-list"></ul>
</div>

<table id="charging-stations">
    <thead>
        <tr>
            <th>Name</th>
            <th>Location</th>
            <th>Contact Number</th>
        </tr>
    </thead>
    <tbody>
        <tr data-coords="27.6937,85.3300">
            <td>Burger House and Crunchy Fried Chicken</td>
            <td><a href="https://www.google.com/maps?q=27.6937,85.3300" target="_blank">Prithvi Hwy, Naubise</a></td>
            <td>+9779745698773</td>
        </tr>
        <tr data-coords="27.7824,85.2727">
            <td>Hills n Horizon Resort</td>
            <td><a href="https://www.google.com/maps?q=27.7824,85.2727" target="_blank">Charaundi, Nepal</a></td>
            <td>+977010420029</td>
        </tr>
        <tr data-coords="27.6643,85.3096">
            <td>Royals Home Resort</td>
            <td><a href="https://www.google.com/maps?q=27.6643,85.3096" target="_blank">Aanbu Khaireni</a></td>
            <td>+977065540269</td>
        </tr>
        <tr data-coords="27.7380,85.6762">
            <td>Charikot Hotel Kings & Lodge</td>
            <td><a href="https://www.google.com/maps?q=27.7380,85.6762" target="_blank">Petrol pump side, Bhimeshwor Municipality</a></td>
            <td>+9779841498668</td>
        </tr>
        <tr data-coords="27.6512,85.4302">
            <td>CG Charging Station</td>
            <td><a href="https://www.google.com/maps?q=27.6512,85.4302" target="_blank">Chardobato, Bhaktapur</a></td>
            <td>null</td>
        </tr>
        <tr data-coords="27.0014,84.8824">
            <td>BYD Showroom Birgunj</td>
            <td><a href="https://www.google.com/maps?q=27.0014,84.8824" target="_blank">Pipra Bypass road, Birgunj</a></td>
            <td>null</td>
        </tr>
        <tr data-coords="27.1791,84.9291">
            <td>CG Fast Charging Station</td>
            <td><a href="https://www.google.com/maps?q=27.1791,84.9291" target="_blank">PF87+82R, Lahan 56500</a></td>
            <td>null</td>
        </tr>
        <tr data-coords="27.7224,85.3232">
            <td>BYD Showroom (Eco Auto Trading Pvt. Ltd.)</td>
            <td><a href="https://www.google.com/maps?q=27.7224,85.3232" target="_blank">Kathmandu 44600, Nepal</a></td>
            <td>+977015705505</td>
        </tr>
        <tr data-coords="28.2296,83.9778">
            <td>Banana & Mushroom Restaurant</td>
            <td><a href="https://www.google.com/maps?q=28.2296,83.9778" target="_blank">H 10, Madanpokhara 32500</a></td>
            <td>+9779857068380</td>
        </tr>
        <tr data-coords="26.4546,87.2812">
            <td>ElectriVa Kanchanbari Station</td>
            <td><a href="https://www.google.com/maps?q=26.4546,87.2812" target="_blank">Pokharia, Biratnagar 56613</a></td>
            <td>+9779851146835</td>
        </tr>
        <tr data-coords="27.6934,85.3215">
            <td>Electriva Janakpur</td>
            <td><a href="https://www.google.com/maps?q=27.6934,85.3215" target="_blank">Kathmandu 44600</a></td>
            <td>+9779851146835</td>
        </tr>
        <tr data-coords="28.2055,83.9814">
            <td>Majestic Lake Front Hotel & Suites</td>
            <td><a href="https://www.google.com/maps?q=28.2055,83.9814" target="_blank">Baidam Rd, Pokhara 33700</a></td>
            <td>+977061591601</td>
        </tr>
        <tr data-coords="28.2061,83.9764">
            <td>CG Motors Charging Station</td>
            <td><a href="https://www.google.com/maps?q=28.2061,83.9764" target="_blank">Nayabazar Rd, Pokhara 33700</a></td>
            <td>+977061591234</td>
        </tr>
        <tr data-coords="27.2636,84.6249">
            <td>Himaldeep Auto Mobile</td>
            <td><a href="https://www.google.com/maps?q=27.2636,84.6249" target="_blank">HJQC+6FC, H12, Birendranagar</a></td>
            <td>+9779858050790</td>
        </tr>
        <tr data-coords="27.4200,85.1400">
            <td>Api Hydropower Mechanical Ltd</td>
            <td><a href="https://www.google.com/maps?q=27.4200,85.1400" target="_blank">Kharanga, FVMF+VM, Manahari 44100</a></td>
            <td>+9779801147083</td>
        </tr>
        <tr data-coords="26.7332,85.9236">
            <td>Green Automobiles (DFSK EV Nepal)</td>
            <td><a href="https://www.google.com/maps?q=26.7332,85.9236" target="_blank">Hotel Rajdurbar Navrang Resort</a></td>
            <td>+9779857032212</td>
        </tr>
        <tr data-coords="27.6844,85.2915">
            <td>Vogo Charging Station</td>
            <td><a href="https://www.google.com/maps?q=27.6844,85.2915" target="_blank">Jawalkhel, Lalitpur</a></td>
            <td>+9779802024682</td>
        </tr>
        <tr data-coords="27.6673,85.3284">
            <td>CG Charging Station</td>
            <td><a href="https://www.google.com/maps?q=27.6673,85.3284" target="_blank">Jaisidewal, Bhaktapur</a></td>
            <td>+9779800549596</td>
        </tr>
        <tr data-coords="27.6437,85.4013">
            <td>Nakshya</td>
            <td><a href="https://www.google.com/maps?q=27.6437,85.4013" target="_blank">Bhaktapur</a></td>
            <td>+9779851360847</td>
        </tr>
        <tr data-coords="28.2262,83.9799">
            <td>Trishuli EV Charging Station</td>
            <td><a href="https://www.google.com/maps?q=28.2262,83.9799" target="_blank">Nuwakot</a></td>
            <td>+9779851360847</td>
        </tr>
        <tr data-coords="28.2283,83.9801">
            <td>Hotel Green Hill</td>
            <td><a href="https://www.google.com/maps?q=28.2283,83.9801" target="_blank">Nuwakot</a></td>
            <td>+9779851360847</td>
        </tr>
        <tr data-coords="27.7172,85.2899">
            <td>Hotel Shankar</td>
            <td><a href="https://www.google.com/maps?q=27.7172,85.2899" target="_blank">Kathmandu 44600</a></td>
            <td>+9779800111346</td>
        </tr>
        <tr data-coords="27.8031,85.2817">
            <td>Manang Hotel</td>
            <td><a href="https://www.google.com/maps?q=27.8031,85.2817" target="_blank">Kathmandu 44600</a></td>
            <td>+9779800539519</td>
        </tr>
        <tr data-coords="27.7044,85.2923">
            <td>Bhaktapur Dhaba</td>
            <td><a href="https://www.google.com/maps?q=27.7044,85.2923" target="_blank">Bhaktapur 44800</a></td>
            <td>+9779800542427</td>
        </tr>
        <tr data-coords="27.9600,83.9618">
            <td>Rest Point Hotel</td>
            <td><a href="https://www.google.com/maps?q=27.9600,83.9618" target="_blank">Birtamod 57200</a></td>
            <td>+9779800640055</td>
        </tr>
        <tr data-coords="28.2246,83.9791">
            <td>Green Pastures Restaurant</td>
            <td><a href="https://www.google.com/maps?q=28.2246,83.9791" target="_blank">Madanpokhara, 32500</a></td>
            <td>+9779811097063</td>
        </tr>
    </tbody>
</table>

<script>
document.getElementById('get-location').addEventListener('click', function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        alert("Geolocation is not supported by this browser.");
    }
});

function showPosition(position) {
    const userCoords = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
    };

    const stations = Array.from(document.querySelectorAll('#charging-stations tbody tr'));
    const distances = stations.map(station => {
        const coords = station.getAttribute('data-coords').split(',').map(Number);
        const distance = haversineDistance(userCoords.lat, userCoords.lng, coords[0], coords[1]);
        return { 
            name: station.cells[0].textContent, 
            location: station.cells[1].textContent, 
            contact: station.cells[2].textContent, 
            distance: distance 
        };
    });

    distances.sort((a, b) => a.distance - b.distance);
    displayNearestStations(distances.slice(0, 3));
}

function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Radius of the Earth in km
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = 
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
        Math.sin(dLon / 2) * Math.sin(dLon / 2); 
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
    const distance = R * c; // Distance in km
    return distance;
}

function toRad(Value) {
    return Value * Math.PI / 180;
}

function displayNearestStations(stations) {
    const stationList = document.getElementById('station-list');
    stationList.innerHTML = ''; // Clear previous results

    stations.forEach(station => {
        const listItem = document.createElement('li');
        listItem.textContent = `${station.name} - ${station.location} (${station.contact}) - Distance: ${station.distance.toFixed(2)} km`;
        stationList.appendChild(listItem);
    });

    document.getElementById('nearest-stations').style.display = 'block';
}

function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            alert("User denied the request for Geolocation.");
            break;
        case error.POSITION_UNAVAILABLE:
            alert("Location information is unavailable.");
            break;
        case error.TIMEOUT:
            alert("The request to get user location timed out.");
            break;
        case error.UNKNOWN_ERROR:
            alert("An unknown error occurred.");
            break;
    }
}
</script>

</body>
</html>
